---
phase: 01-foundation-menu-bar
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Package.swift
  - Sources/OptionC/OptionCApp.swift
  - Sources/OptionC/State/AppState.swift
  - Sources/OptionC/Models/RecordingMode.swift
  - Sources/OptionC/Models/RecordingState.swift
  - Sources/OptionC/Resources/Info.plist
autonomous: true

must_haves:
  truths:
    - "App compiles and runs as a Swift package"
    - "App appears in menu bar with mic.circle icon"
    - "App does NOT appear in Dock"
  artifacts:
    - path: "Package.swift"
      provides: "Swift package manifest with KeyboardShortcuts dependency"
      contains: "KeyboardShortcuts"
    - path: "Sources/OptionC/OptionCApp.swift"
      provides: "App entry point with MenuBarExtra"
      contains: "MenuBarExtra"
    - path: "Sources/OptionC/State/AppState.swift"
      provides: "Centralized state coordinator"
      contains: "@MainActor"
    - path: "Sources/OptionC/Resources/Info.plist"
      provides: "App configuration with LSUIElement"
      contains: "LSUIElement"
  key_links:
    - from: "OptionCApp.swift"
      to: "AppState.swift"
      via: "@StateObject injection"
      pattern: "@StateObject.*AppState"
---

<objective>
Set up the Option-C Swift project with MenuBarExtra and core state management infrastructure.

Purpose: Establish the foundational Swift project structure with a visible menu bar presence. This creates the scaffold that all subsequent work builds upon.

Output: A running menu bar app that shows a microphone icon. Icon is visible, app runs, Dock icon is hidden.
</objective>

<execution_context>
@/Users/connecteddale/.claude/get-shit-done/workflows/execute-plan.md
@/Users/connecteddale/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-menu-bar/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Swift Package Project Structure</name>
  <files>
    Package.swift
    Sources/OptionC/OptionCApp.swift
    Sources/OptionC/State/AppState.swift
    Sources/OptionC/Models/RecordingMode.swift
    Sources/OptionC/Models/RecordingState.swift
  </files>
  <action>
    Create a Swift package for the Option-C macOS app:

    1. **Package.swift**: Create manifest with:
       - Name: "OptionC"
       - Platform: macOS 13.0+
       - Product: executable named "OptionC"
       - Dependency: KeyboardShortcuts from "https://github.com/sindresorhus/KeyboardShortcuts" version 2.4.0+
       - Target "OptionC" with path "Sources/OptionC" and dependency on KeyboardShortcuts

    2. **Sources/OptionC/OptionCApp.swift**: Create @main entry point with:
       - Import SwiftUI
       - @StateObject private var appState = AppState()
       - MenuBarExtra scene with label binding to appState.menuBarIcon
       - Placeholder Text("Menu Content") in menu content for now

    3. **Sources/OptionC/State/AppState.swift**: Create centralized state coordinator:
       - @MainActor class AppState: ObservableObject
       - @Published var currentState: RecordingState = .idle
       - @AppStorage("recordingMode") var recordingMode: RecordingMode = .toggle
       - Computed property menuBarIcon returning SF Symbol name based on currentState:
         - idle: "mic.circle"
         - recording: "mic.circle.fill"
         - processing: "waveform.circle"

    4. **Sources/OptionC/Models/RecordingState.swift**: Create enum:
       - enum RecordingState with cases: idle, recording, processing

    5. **Sources/OptionC/Models/RecordingMode.swift**: Create enum:
       - enum RecordingMode: String, Codable with cases: toggle, pushToTalk

    Use exact patterns from 01-RESEARCH.md code examples. Do NOT use Objective-C or NSApplication delegate patterns.
  </action>
  <verify>
    cd /Users/connecteddale/Library/CloudStorage/Dropbox/portfolio-life/Python/option-c && swift build

    Build should succeed without errors. Warnings about unused variables are acceptable.
  </verify>
  <done>
    - Package.swift exists with KeyboardShortcuts dependency
    - All source files exist in correct locations
    - swift build completes successfully
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Info.plist for Dock Hiding</name>
  <files>
    Sources/OptionC/Resources/Info.plist
    Package.swift (update)
  </files>
  <action>
    Create Info.plist to configure the app as a menu bar utility:

    1. **Sources/OptionC/Resources/Info.plist**: Create XML plist with:
       ```xml
       <?xml version="1.0" encoding="UTF-8"?>
       <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
       <plist version="1.0">
       <dict>
           <key>CFBundleName</key>
           <string>Option-C</string>
           <key>CFBundleIdentifier</key>
           <string>com.optionc.app</string>
           <key>CFBundleVersion</key>
           <string>1.0</string>
           <key>CFBundleShortVersionString</key>
           <string>1.0</string>
           <key>LSUIElement</key>
           <true/>
           <key>NSMicrophoneUsageDescription</key>
           <string>Option-C needs microphone access to record your voice for transcription.</string>
           <key>NSSpeechRecognitionUsageDescription</key>
           <string>Option-C uses speech recognition to transcribe your recordings.</string>
       </dict>
       </plist>
       ```

    2. **Package.swift**: Update the target to include resources:
       - Add resources: [.copy("Resources/Info.plist")] to the OptionC target

    Note: LSUIElement = true hides the app from Dock. The usage descriptions are for future phases but included now for completeness.
  </action>
  <verify>
    ls -la /Users/connecteddale/Library/CloudStorage/Dropbox/portfolio-life/Python/option-c/Sources/OptionC/Resources/Info.plist
    grep -q "LSUIElement" /Users/connecteddale/Library/CloudStorage/Dropbox/portfolio-life/Python/option-c/Sources/OptionC/Resources/Info.plist && echo "LSUIElement found"
    cd /Users/connecteddale/Library/CloudStorage/Dropbox/portfolio-life/Python/option-c && swift build
  </verify>
  <done>
    - Info.plist exists in Resources directory
    - Contains LSUIElement = true
    - swift build still succeeds
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify Menu Bar App Runs</name>
  <files>None (verification only)</files>
  <action>
    Build and run the app to verify menu bar presence:

    1. Build in release mode: swift build -c release
    2. Run the built executable briefly to verify it doesn't crash
    3. The app should launch without errors (though we can't visually verify menu bar in headless mode)

    Note: Full visual verification requires running on macOS with display. This task confirms the binary is valid.
  </action>
  <verify>
    cd /Users/connecteddale/Library/CloudStorage/Dropbox/portfolio-life/Python/option-c && swift build -c release

    # Verify binary exists
    ls -la .build/release/OptionC

    # Check binary is executable
    file .build/release/OptionC
  </verify>
  <done>
    - Release build succeeds
    - Binary exists at .build/release/OptionC
    - Binary is a valid macOS executable
  </done>
</task>

</tasks>

<verification>
Phase 1 Plan 01 verification checklist:

1. Project structure:
   - [ ] Package.swift at project root
   - [ ] Sources/OptionC/ directory with all Swift files
   - [ ] Sources/OptionC/Resources/Info.plist exists

2. Build verification:
   - [ ] swift build succeeds without errors
   - [ ] swift build -c release succeeds
   - [ ] Binary produced at .build/release/OptionC

3. Code patterns:
   - [ ] AppState uses @MainActor annotation
   - [ ] AppState uses @Published for currentState
   - [ ] OptionCApp uses MenuBarExtra scene
   - [ ] Info.plist contains LSUIElement = true
</verification>

<success_criteria>
- swift build completes successfully
- All required files exist in correct locations
- AppState properly defines state management with @MainActor
- MenuBarExtra is wired to AppState.menuBarIcon
- Info.plist configures app as menu bar utility (LSUIElement = true)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-menu-bar/01-01-SUMMARY.md`
</output>
